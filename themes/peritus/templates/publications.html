{% extends "base.html" %}

{%- macro print_entry(entry) -%}
{% set tags = entry.tags %}
<li class="publist-item"><a id="{{ entry.citation_key }}"></a><span class="publication-title">{{ tags.title | replace(from="{", to="") | replace(from="}", to="") }}</span>
    {%- if tags.addendum -%}
        {%- if tags.addendum | lower == "best paper award" %} <i class="fa-solid fa-award" title="Best paper award"></i>
        {%- endif -%}
    {%- endif -%}
    {%- if tags.doi %} <a href="{{ tags.doi | safe }}"><i class="ai ai-doi" title="DOI"></i></a>
    {%- endif -%}
    {%- if not tags.nopdf %} <a href="{{ config.extra.publication.prefix | safe }}/publications/{{ entry.citation_key | lower }}.pdf"><i class="fa-regular fa-file-pdf" title="PDF"></i></a>
    {%- endif %} <details class="bibtex"><summary><i class="fa-solid fa-quote-left" title="BibLaTeX"></i></summary><pre class="bib-data"><code>@{{ entry.entry_type }}{ {{- entry.citation_key }},
    author = { {{- tags.author -}} },
    title = { {{- tags.title -}} },
{%- if entry.entry_type == "inproceedings" %}  
    booktitle = { {{- tags.booktitle -}} },
    date = { {{- tags.date -}} },
    {%- if tags.address %}
    address = { {{- tags.address -}} },
    {%- endif -%}
{%- elif entry.entry_type == "article" %}
    journal = { {{- tags.journal -}} },
    year = { {{- tags.year -}} },
    volume = { {{- tags.volume -}} },
    {%- if tags.number %}
    number = { {{- tags.number -}} },
    {%- endif -%}
{%- elif entry.entry_type == "inbook" %}
    booktitle = { {{- tags.booktitle -}} },
    year = { {{- tags.year -}} },
    pages = { {{- tags.pages -}} },
    editor = { {{- tags.editor -}} },
    publisher = { {{- tags.publisher -}} },
{%- endif %}
{%- if tags.doi %}
    doi = { {{- tags.doi | safe -}} },
{%- endif %}
}</code></pre></details><span class="publication-authors">
    {%- for author in tags.author | split(pat=" and ") -%}
        {%- if not loop.first -%}
            {%- if loop.last %} &amp; {% else -%} , {% endif -%}
        {%- endif -%}
        {%- set name = author | split(pat=",") -%}
        {%- set initial = name.1 | default(value="") | truncate(length=2, end="") -%}
        {%- set author_str = name.0 ~ "," ~ initial ~ "." | trim %}
        {%- if author == config.extra.publication.author -%}
            {%- set author_class = "highlighted-author" -%}
        {%- else -%}
            {%- set author_class = "author" -%}
        {%- endif -%}
        <span class="{{ author_class }}">{{ author_str }}</span>
    {%- endfor -%}
    </span><br>
    {%- if entry.entry_type == "inproceedings" -%}
        <span class="publication-venue">{{ tags.booktitle | replace(from="\", to="") }}</span>, <span class="publication-year">{{ tags.date | truncate(length=4, end="") }}</span>
    {%- elif entry.entry_type == "article" -%}
        <span class="publication-venue">{{ tags.journal | replace(from="\", to="") }}</span>, <span class="publication-volume">{{ tags.volume -}}</span>
        {%- if tags.number -%}
            .{{ tags.number }}
        {%- endif -%}
        (<span class="publication-year">{{ tags.year }}</span>)
        {%- if tags.pages -%}
            , pp. {{ tags.pages | replace(from="--", to="&ndash;") | safe }}
        {%- endif -%}
    {%- elif entry.entry_type == "inbook" -%}
        In <span class="publication-venue">{{ tags.booktitle | replace(from="\", to="") }}</span>, pp. {{ tags.pages | replace(from="--", to="&ndash;") | safe }}. {{ tags.publisher }}, <span class="publication-year">{{ tags.year }}</span>
    {%- elif entry.entry_type == "misc" -%}
        <span class="publication-year">{{ tags.year }}</span>
    {%- endif -%}
</li>
{%- endmacro -%}

{% block style %}
<style>
    .publications-metadata {
        max-width: 800px;
        margin: 1rem auto 2rem auto;
        padding: 1rem;
        background: var(--secondary-background, #f8f9fa);
        border-left: 4px solid var(--primary-color, #007bff);
        border-radius: 4px;
        font-size: 0.9rem;
    }

    .metadata-info {
        margin: 0;
        color: var(--text-secondary, #6c757d);
    }

    .metadata-label {
        font-weight: 600;
        color: var(--text-color, #212529);
    }

    .metadata-separator {
        margin: 0 0.5rem;
        color: var(--text-secondary, #6c757d);
    }

    .metadata-info a {
        color: var(--primary-color, #007bff);
        text-decoration: none;
        font-weight: 500;
    }

    .metadata-info a:hover {
        text-decoration: underline;
    }

    .publications-list {
        max-width: 800px;
        margin: 0 auto;
    }

    .publication-item {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--card-background);
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
    }

    .publication-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--hover-shadow);
    }

    .publication-title {
        margin: 0 0 0.5rem 0;
        font-size: 1.2rem;
        font-weight: 600;
        line-height: 1.4;
    }

    .publication-title a {
        color: var(--primary-color);
        text-decoration: none;
    }

    .publication-title a:hover {
        text-decoration: underline;
    }

    .publication-meta {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-color);
    }

    .publication-year {
        font-weight: 600;
        color: var(--text-color);
    }

    .publication-venue {
        font-style: italic;
        color: var(--text-color);
    }

    .publication-volume {
        color: var(--text-color);
    }

    .publication-authors {
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: var(--text-color);
    }

    .author {
        font-weight: 500;
    }

    .highlighted-author {
        color: #FEBC11;
        font-weight: 600;
    }

    .publication-abstract details {
        margin-top: 1rem;
    }

    .publication-abstract summary {
        cursor: pointer;
        font-weight: 500;
        color: var(--text-color);
        padding: 0.5rem 0;
        transition: color 0.2s ease;
    }

    .publication-abstract summary:hover {
        color: var(--primary-color);
    }

    .publication-abstract p {
        margin: 0.5rem 0 0 0;
        padding: 0.5rem 0;
        line-height: 1.6;
        color: var(--text-color);
        border-top: 1px solid var(--border-color);
    }

    .publication-footer {
        margin-top: 1rem;
    }

    .publication-link {
        padding: 0.5rem 1rem;
        background-color: var(--border-color);
        border-radius: 0.25rem;
        font-size: 0.9rem;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .publication-link:hover {
        background-color: var(--primary-color);
        color: white;
    }

    @media (max-width: 768px) {
        .publication-item {
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .publication-title {
            font-size: 1.1rem;
        }
    }
</style>
{% endblock style %}

{% block content %}
<div class="section-template">
    <div class="container">
        <div class="section-header">
            <h1>{{ page.title }}</h1>
        </div>

        <p>Jump to <a href="#article">journals</a>, <a href="#inbook">books</a>, <a href="#misc">preprints</a></p>
        {% set data = load_data(path="data/publications/paper.bib", format="bibtex") %}
        <h2>Conferences</h2>
        <ul class="publist">
            {%- for entry in data.bibliographies -%}
                {%- if entry.entry_type == "inproceedings" -%}
                    {{ self::print_entry(entry=entry) }}
                {%- endif -%}
            {%- endfor -%}
        </ul>
        <a id="article"></a>
        <h2>Journals</h2>
        <ul class="publist">
            {%- for entry in data.bibliographies -%}
                {%- if entry.entry_type == "article" -%}
                    {{ self::print_entry(entry=entry) }}
                {%- endif -%}
            {%- endfor -%}
        </ul>
        <a id="inbook"></a>
        <h2>Book chapters</h2>
        <ul class="publist">
            {%- for entry in data.bibliographies -%}
                {%- if entry.entry_type == "inbook" -%}
                    {{ self::print_entry(entry=entry) }}
                {%- endif -%}
            {%- endfor -%}
        </ul>
        {% set data = load_data(path="data/publications/preprint.bib", format="bibtex") %}
        <a id="misc"></a>
        <h2>Preprints</h2>
        <ul class="publist">
            {%- for entry in data.bibliographies -%}
                {{ self::print_entry(entry=entry) }}
            {%- endfor -%}
        </ul>
    </div>
</div>
{% endblock content %}
